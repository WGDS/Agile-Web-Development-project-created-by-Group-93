<div class="movie-collection-wrapper">
    <h3 class="collection-title">Movie Collection</h3>
    
    <!-- Movie viewing statistics -->
    <div class="movie-stats">
        <div class="stat-item">
            <span class="stat-value">{{ movie_stats.total_movies }}</span>
            <span class="stat-label">Movies Rated</span>
        </div>
        <div class="stat-item">
            <span class="stat-value">{{ movie_stats.avg_rating }}/10</span>
            <span class="stat-label">Average Rating</span>
        </div>
        {% if movie_stats.favorite_genres %}
        <div class="stat-item">
            <span class="stat-value">{{ movie_stats.favorite_genres[0][0] }}</span>
            <span class="stat-label">Favorite Genre</span>
        </div>
        {% endif %}
    </div>
    
    <!-- Rating distribution -->
    {% if movie_stats.ratings_distribution %}
    <div class="rating-distribution">
        <h4>Rating Distribution</h4>
        <div class="rating-bars">
            {% for i in range(1, 11) %}
                {% set count = movie_stats.ratings_distribution.get(i, 0) %}
                {% set percentage = (count / movie_stats.total_movies * 100) if movie_stats.total_movies > 0 else 0 %}
                <div class="rating-bar-container">
                    <span class="rating-label">{{ i }}</span>
                    <div class="rating-bar-wrapper">
                        <div class="rating-bar" style="width: {{ percentage }}%;" data-count="{{ count }}"></div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Favorite movies -->
    {% if favorite_movies %}
    <div class="favorite-movies">
        <h4>Top Rated Movies</h4>
        <div class="movie-grid">
            {% for um in favorite_movies %}
            <div class="movie-card" data-movie-id="{{ um.movie.id }}" data-current-rating="{{ um.user_rating }}">
                <div class="movie-poster">
                    <img src="{{ um.movie.poster_url }}" alt="{{ um.movie.title }}" onerror="this.src='/static/images/no_poster.jpg'">
                    <div class="movie-rating">{{ um.user_rating }}/10</div>
                    {% if is_own_profile %}
                    <div class="movie-actions">
                        <button class="edit-rating-btn" title="Edit Rating">✏️</button>
                    </div>
                    {% endif %}
                </div>
                <div class="movie-info">
                    <div class="movie-title" title="{{ um.movie.title }}">{{ um.movie.title }}</div>
                    <div class="movie-year">{{ um.movie.year }}</div>
                </div>
                {% if is_own_profile %}
                <div class="rating-edit-form" style="display: none;">
                    <input type="number" class="rating-input" min="0" max="10" step="0.1" value="{{ um.user_rating }}">
                    <div class="rating-buttons">
                        <button class="save-rating-btn">Save</button>
                        <button class="cancel-rating-btn">Cancel</button>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="no-favorites">
        <p>No rated movies yet!</p>
        {% if is_own_profile %}
        <a href="{{ url_for('uploadReview') }}" class="rate-movies-btn">Rate Movies</a>
        {% endif %}
    </div>
    {% endif %}
</div>